<!DOCTYPE html>
<html>
<head>
  <title>Focus Timer with Local Sounds</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: Arial, sans-serif;
      background: #f0f0f0;
    }

    .control-panel {
      position: fixed;
      top: 20px;
      left: 20px;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      width: 400px;
    }

    .input-group {
      margin: 15px 0;
    }

    .input-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #333;
    }

    .segment-row {
      display: flex;
      gap: 10px;
      margin: 10px 0;
    }

    .segment-input {
      flex: 1;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    .sound-select {
      flex: 1;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: white;
    }

    #startBtn {
      width: 100%;
      padding: 12px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 15px;
    }

    .timer-display {
      text-align: center;
      margin-top: 20px;
      font-size: 1.2em;
    }

    #countdown {
      font-family: monospace;
      font-size: 1.5em;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="control-panel">
    <div class="input-group">
      <label>Total Time (minutes)</label>
      <input type="number" id="totalTime" class="segment-input" min="1" value="60">
    </div>

    <div class="input-group">
      <label>Number of Segments</label>
      <input type="number" id="segmentCount" class="segment-input" min="1" value="2">
    </div>

    <div id="segmentInputs"></div>

    <button id="startBtn">Start Focus Session</button>

    <div class="timer-display">
      <div id="currentPhase">Ready</div>
      <div id="countdown">00:00</div>
    </div>
  </div>

  <!-- 本地音檔 -->
  <audio id="stormSound" src="sounds/storm01.mp3"></audio>
  <audio id="lightRainSound" src="sounds/lightrain01.mp3"></audio>

  <script>
    let currentTimer = null;
    let currentAudio = null;

    // 聲音選項配置
    const soundOptions = [
      { id: 'none', label: 'No Sound' },
      { id: 'storm', label: 'Storm' },
      { id: 'lightrain', label: 'Light Rain' }
    ];

    // 生成分段輸入
    function generateSegments(count) {
      const container = document.getElementById('segmentInputs');
      container.innerHTML = '';
      
      for (let i = 0; i < count; i++) {
        const div = document.createElement('div');
        div.className = 'segment-row';
        
        // 時間輸入
        const timeInput = document.createElement('input');
        timeInput.type = 'number';
        timeInput.className = 'segment-input';
        timeInput.min = 1;
        timeInput.value = i % 2 === 0 ? 25 : 5;
        timeInput.placeholder = 'Minutes';

        // 聲音選擇
        const soundSelect = document.createElement('select');
        soundSelect.className = 'sound-select';
        soundOptions.forEach(opt => {
          const option = document.createElement('option');
          option.value = opt.id;
          option.textContent = opt.label;
          soundSelect.appendChild(option);
        });

        div.appendChild(timeInput);
        div.appendChild(soundSelect);
        container.appendChild(div);
      }
    }

    // 播放聲音控制
    function playSound(type) {
      if (currentAudio) {
        currentAudio.pause();
        currentAudio.currentTime = 0;
      }

      const audioMap = {
        storm: document.getElementById('stormSound'),
        lightrain: document.getElementById('lightRainSound')
      };

      currentAudio = audioMap[type];
      if (currentAudio) {
        currentAudio.loop = true;
        currentAudio.play().catch(e => {
          console.log('需要點擊頁面任意位置授權音效播放');
          document.body.style.cursor = 'pointer';
          document.body.onclick = () => {
            currentAudio.play();
            document.body.style.cursor = 'default';
          }
        });
      }
    }

    // 啟動計時器
    function startTimer() {
      if (currentTimer) clearInterval(currentTimer);

      const totalMinutes = parseInt(document.getElementById('totalTime').value);
      const segments = Array.from(document.querySelectorAll('.segment-input'))
        .map(input => parseInt(input.value) * 60 || 60);
      const sounds = Array.from(document.querySelectorAll('.sound-select'))
        .map(select => select.value);

      let currentSegment = 0;
      let remaining = segments[0];
      playSound(sounds[0]);

      currentTimer = setInterval(() => {
        remaining--;
        
        // 更新顯示
        document.getElementById('countdown').textContent = 
          `${Math.floor(remaining / 60).toString().padStart(2, '0')}:` +
          `${(remaining % 60).toString().padStart(2, '0')}`;
        
        document.getElementById('currentPhase').textContent = 
          `Segment ${currentSegment + 1} (${soundOptions.find(o => o.id === sounds[currentSegment]).label})`;

        // 切換分段
        if (remaining <= 0) {
          currentSegment++;
          if (currentSegment >= segments.length) {
            clearInterval(currentTimer);
            playSound('none');
            alert('Session Complete!');
            return;
          }
          remaining = segments[currentSegment];
          playSound(sounds[currentSegment]);
        }
      }, 1000);
    }

    // 初始化
    document.getElementById('segmentCount').addEventListener('input', function() {
      generateSegments(Math.max(1, this.value));
    });

    document.getElementById('startBtn').addEventListener('click', startTimer);

    // 初始生成
    generateSegments(2);
  </script>
</body>
</html>
